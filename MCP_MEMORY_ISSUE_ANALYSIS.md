# MCPè®°å¿†ç³»ç»Ÿé—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

æ ¹æ®å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ—¥å¿—ï¼Œæˆ‘å‘ç°äº†è®°å¿†ç³»ç»Ÿæ— æ³•æ­£å¸¸å·¥ä½œçš„æ ¹æœ¬åŸå› ï¼š

### 1. æ ¸å¿ƒé—®é¢˜ï¼šæ¥å£å‚æ•°ä¸åŒ¹é…

**MCP Adapter å‘é€çš„å‚æ•°**ï¼š
```python
request_data = {
    "message": message,
    "memorizing": True,  # âœ… æ·»åŠ è®°å¿†æ—¶ä½¿ç”¨
    "user_id": user_id,
    "search_only": True  # âŒ æœç´¢æ—¶ä½¿ç”¨ï¼Œä½†åç«¯ä¸è®¤è¯†æ­¤å‚æ•°
}
```

**MIRIX FastAPI åç«¯æœŸå¾…çš„å‚æ•°**ï¼ˆMessageRequestï¼‰ï¼š
```python
class MessageRequest(BaseModel):
    message: Optional[str] = None
    image_uris: Optional[List[str]] = None
    sources: Optional[List[str]] = None
    voice_files: Optional[List[str]] = None
    memorizing: bool = False          # âœ… æ”¯æŒ
    is_screen_monitoring: Optional[bool] = False
    user_id: Optional[str] = None     # âœ… æ”¯æŒ
    force_absorb: bool = False
    # âŒ æ²¡æœ‰ search_only å‚æ•°
```

### 2. å…·ä½“é—®é¢˜

#### é—®é¢˜1ï¼šæœç´¢è®°å¿†å¤±è´¥
- MCPå‘é€ `"search_only": True` å‚æ•°
- åç«¯ä¸è®¤è¯†æ­¤å‚æ•°ï¼Œå¯¼è‡´æœç´¢å¤±æ•ˆ
- è¿”å›é”™è¯¯å“åº”ï¼š`{'response': 'ERROR_RESPONSE_FAILED', 'status': 'success'}`

#### é—®é¢˜2ï¼šå¯¹è¯åŠŸèƒ½æ— å“åº”
- MCP Adapter é”™è¯¯å¤„ç†å“åº”æ•°æ®æ ¼å¼
- æœŸå¾…å­—å…¸æ ¼å¼ä½†æ”¶åˆ°å­—ç¬¦ä¸²

#### é—®é¢˜3ï¼šç”¨æˆ·æ¡£æ¡ˆä¸ºç©º
- æ¡£æ¡ˆæŸ¥è¯¢æ²¡æœ‰ä½¿ç”¨æ­£ç¡®çš„å‚æ•°æˆ–æ–¹æ³•
- åç«¯æ— æ³•ç†è§£æ¡£æ¡ˆæŸ¥è¯¢æ„å›¾

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®æ”¹MCP Adapterçš„æ¥å£è°ƒç”¨æ–¹å¼

éœ€è¦ä¿®æ”¹ `mirix_adapter.py` ä¸­çš„æ¥å£è°ƒç”¨æ–¹å¼ï¼Œä½¿å…¶ä¸MIRIXåç«¯å…¼å®¹ã€‚

#### 1.1 ä¿®å¤æœç´¢è®°å¿†æ¥å£
```python
# å½“å‰é”™è¯¯çš„å®ç°
request_data = {
    "message": message,
    "user_id": user_id,
    "search_only": True  # âŒ åç«¯ä¸æ”¯æŒ
}

# æ­£ç¡®çš„å®ç°
request_data = {
    "message": f"æœç´¢ç›¸å…³è®°å¿†ï¼š{query}",  # é€šè¿‡æ¶ˆæ¯å†…å®¹è¡¨è¾¾æœç´¢æ„å›¾
    "user_id": user_id,
    "memorizing": False  # æœç´¢æ—¶ä¸è§¦å‘è®°å¿†
}
```

#### 1.2 ä¿®å¤å¯¹è¯åŠŸèƒ½
```python
# å½“å‰çš„å®ç°
request_data = {
    "message": message,
    "user_id": user_id,
    "use_memory": True  # âŒ åç«¯ä¸æ”¯æŒ
}

# æ­£ç¡®çš„å®ç°
request_data = {
    "message": message,
    "user_id": user_id,
    "memorizing": False  # å¯¹è¯æ—¶ä¸å¼ºåˆ¶è®°å¿†
}
```

#### 1.3 ä¿®å¤æ¡£æ¡ˆæŸ¥è¯¢
```python
# å½“å‰çš„å®ç°
request_data = {
    "message": message,
    "user_id": user_id,
    "profile_query": True  # âŒ åç«¯ä¸æ”¯æŒ
}

# æ­£ç¡®çš„å®ç°  
request_data = {
    "message": f"è¯·æ€»ç»“ç”¨æˆ· {user_id} çš„æ¡£æ¡ˆä¿¡æ¯å’Œè®°å¿†å†…å®¹",
    "user_id": user_id,
    "memorizing": False
}
```

### æ–¹æ¡ˆ2ï¼šuser_idé—®é¢˜åˆ†æ

ä»æ—¥å¿—çœ‹ï¼Œuser_idä¼ é€’æ˜¯æ­£ç¡®çš„ï¼š
```
user_id=default_user
```

ä½†éœ€è¦ç¡®ä¿ï¼š
1. MIRIXåç«¯æ­£ç¡®å¤„ç†ç”¨æˆ·ä¸Šä¸‹æ–‡åˆ‡æ¢
2. è®°å¿†ä¸ç”¨æˆ·IDæ­£ç¡®å…³è”
3. æœç´¢æ—¶ä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·ID

## ğŸ”§ å…·ä½“ä¿®å¤æ­¥éª¤

### æ­¥éª¤1ï¼šæ£€æŸ¥MIRIXåç«¯Agenté…ç½®
ç¡®è®¤åç«¯Agentæ˜¯å¦æ­£ç¡®åˆå§‹åŒ–ï¼Œä»¥åŠæ˜¯å¦æ”¯æŒå¤šç”¨æˆ·ã€‚

### æ­¥éª¤2ï¼šä¿®æ”¹MCP Adapter
é‡å†™æ¥å£è°ƒç”¨æ–¹å¼ï¼Œç§»é™¤ä¸æ”¯æŒçš„å‚æ•°ã€‚

### æ­¥éª¤3ï¼šæµ‹è¯•éªŒè¯
1. æ·»åŠ è®°å¿†åç«‹å³æµ‹è¯•æœç´¢
2. ç¡®è®¤ç”¨æˆ·ä¸Šä¸‹æ–‡åˆ‡æ¢æ­£å¸¸
3. éªŒè¯è®°å¿†æŒä¹…åŒ–

## ğŸ“‹ é¢„æœŸä¿®å¤æ•ˆæœ

ä¿®å¤åçš„å“åº”åº”è¯¥æ˜¯ï¼š

**æ·»åŠ è®°å¿†**ï¼š
```json
{
  "success": true,
  "message": "è®°å¿†æ·»åŠ æˆåŠŸ"
}
```

**æœç´¢è®°å¿†**ï¼š
```json
{
  "success": true,
  "results": {
    "response": "æ‰¾åˆ°ç›¸å…³è®°å¿†ï¼šæµ‹è¯•è®°å¿†æ·»åŠ åŠŸèƒ½...",
    "status": "success"
  }
}
```

**è®°å¿†å¯¹è¯**ï¼š
```json
{
  "success": true,
  "response": {
    "response": "æˆ‘è®°ä½äº†ä½ çš„æµ‹è¯•ä¿¡æ¯...",
    "status": "success"
  }
}
```

## ğŸ¯ æ ¹æœ¬åŸå› æ€»ç»“

é—®é¢˜ä¸åœ¨äºuser_idï¼Œè€Œåœ¨äºï¼š
1. **æ¥å£å‚æ•°ä¸åŒ¹é…**ï¼šMCPå‘é€äº†åç«¯ä¸æ”¯æŒçš„å‚æ•°
2. **æœç´¢æ–¹å¼é”™è¯¯**ï¼šåº”è¯¥é€šè¿‡æ¶ˆæ¯å†…å®¹è¡¨è¾¾æœç´¢æ„å›¾ï¼Œè€Œä¸æ˜¯ç‰¹æ®Šå‚æ•°
3. **å“åº”å¤„ç†é”™è¯¯**ï¼šæ²¡æœ‰æ­£ç¡®è§£æåç«¯è¿”å›çš„æ•°æ®ç»“æ„

ä¿®å¤è¿™äº›é—®é¢˜åï¼Œè®°å¿†ç³»ç»Ÿåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œã€‚
